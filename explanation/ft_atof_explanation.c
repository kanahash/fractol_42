/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ft_atof_explanation.c                              :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: kanahash <kanahash@student.42.fr>          +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/04/19 12:20:48 by kanahash          #+#    #+#             */
/*   Updated: 2025/04/19 12:22:21 by kanahash         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h" // ヘッダーファイルをインクルード

// 整数部分を文字列から読み取る関数
static double	read_integer(char *str)
{
	double nmb = 0; // 変換した整数部分を格納する変数
	// 文字列が数字を含んでいる限り、数字を読み取り続ける
	while (ft_isdigit(*str)) // ft_isdigitは数字かどうかを確認する関数
	{
		// nmbを10倍して、現在の数字を加算する（nmbの桁を上げる処理）
		nmb = nmb * 10 + *str++ - '0'; // '0'を引くことで、数字の文字を整数に変換
	}
	return (nmb); // 整数部分を返す
}

// 小数点以下の部分を文字列から読み取る関数
static double	read_decimal_point(char *str)
{
	double nmb = 0; // 変換した小数部分を格納する変数
	int power = 1;  // 小数点の位置を保持するための変数。最初は1（1の桁）
	// 文字列が数字を含んでいる限り、小数部分を読み取り続ける
	while (ft_isdigit(*str)) // ft_isdigitは数字かどうかを確認する関数
	{
		// nmbを10倍して、現在の数字を加算
		nmb = nmb * 10 + *str++ - '0'; // '0'を引くことで、数字の文字を整数に変換
		// powerを10倍して、小数点以下の桁を反映させる準備
		power *= 10; // powerは、10, 100, 1000…と増えていく
	}
	// 小数部分をpowerで割って、小数点の位置を正しくする
	return (nmb / power); // nmbは整数なので、powerで割って小数にする
}

// 文字列を浮動小数点数に変換する関数
double	ft_atof(char *str)
{
	int sign = 1;   // 数字の符号（正か負か）を格納する変数
	double nmb = 0; // 最終的な浮動小数点数を格納する変数
	// 空白やタブなどの空白文字をスキップする
	while ((*str >= 9 && *str <= 13) || *str == 32) // ASCIIコードで空白文字範囲をチェック
		str++;                                      // 空白を飛ばして次の文字へ進む
	// 数字の前に'+'または'-'があれば、符号を設定する
	if (*str == '-' || *str == '+')
	{
		if (*str++ == '-') // '-'なら負の数
			sign = -1;     // signを-1に変更
	}
	// 整数部分の処理
	nmb = read_integer(str); // 整数部分を読み取り、nmbに格納
	// 小数点があれば、その後の小数部分を読み取る
	if (*str == '.')
		str++; // 小数点をスキップして次の文字へ
	// 小数部分の処理
	nmb += read_decimal_point(str); // 小数部分を読み取り、nmbに加算
	return (sign * nmb);            // 符号を反映した最終的な浮動小数点数を返す
}
